<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modelo 3D: Sincronizador Virtual</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #050b14;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            color: #fff;
        }
        #canvas-container {
            width: 100vw;
            height: 100vh;
            display: block;
        }
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            justify-content: space-between;
            padding: 30px;
            box-sizing: border-box;
        }
        .panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 20px;
            width: 320px;
            pointer-events: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        h2 {
            margin-top: 0;
            color: #3b82f6;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 10px;
        }
        .data-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 0.9rem;
        }
        .data-label { color: #94a3b8; }
        .data-value { font-weight: bold; color: #10b981; font-family: monospace; font-size: 1rem;}
        .value-blue { color: #3b82f6; }
        .value-warning { color: #f59e0b; }
        
        button {
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover { background: #2563eb; }
        
        #instructions {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.9rem;
            color: #cbd5e1;
            pointer-events: none;
        }
    </style>
    <!-- Importar Three.js y OrbitControls -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>

    <div id="canvas-container"></div>

    <div id="ui-layer">
        <!-- Panel Izquierdo: Ingeniería Industrial -->
        <div class="panel">
            <h2>Estructura Física (Industrial)</h2>
            <div class="data-row">
                <span class="data-label">Módulo:</span>
                <span class="data-value value-blue">Estación 01</span>
            </div>
            <div class="data-row">
                <span class="data-label">Estado Mecánico:</span>
                <span class="data-value">Óptimo</span>
            </div>
            <div class="data-row">
                <span class="data-label">Carga Actual:</span>
                <span class="data-value" id="peso-ui">0.00 kg</span>
            </div>
            <div class="data-row">
                <span class="data-label">Tolerancia FEA:</span>
                <span class="data-value value-blue">25.0 Tons</span>
            </div>
            <button id="btn-simular" onclick="simularCarga()">Simular Descarga de Bultos</button>
            <button id="btn-limpiar" onclick="limpiarPlataforma()" style="background: #475569; margin-top: 10px;">Despejar Plataforma</button>
        </div>

        <!-- Panel Derecho: Ingeniería de Sistemas -->
        <div class="panel">
            <h2>Telemetría Edge (Sistemas)</h2>
            <div class="data-row">
                <span class="data-label">Red Local:</span>
                <span class="data-value">Conectada</span>
            </div>
            <div class="data-row">
                <span class="data-label">Autenticación HSM:</span>
                <span class="data-value">Zero-Trust OK</span>
            </div>
            <div class="data-row">
                <span class="data-label">Filtro de Kalman:</span>
                <span class="data-value value-blue" id="kalman-ui">Activo (Ruido: 0.5%)</span>
            </div>
            <div class="data-row">
                <span class="data-label">Latencia Edge:</span>
                <span class="data-value" id="latencia-ui">12 ms</span>
            </div>
            <div class="data-row">
                <span class="data-label">Sincronización Nube:</span>
                <span class="data-value value-blue" id="sync-ui">En Espera...</span>
            </div>
        </div>
    </div>

    <div id="instructions">
        Click Izquierdo: Rotar | Rueda: Zoom | Click Derecho: Mover
    </div>

    <script>
        // Variables globales
        let scene, camera, renderer, controls;
        let plataforma, sensores = [], cajas = [];
        let pesoActual = 0;
        let simulando = false;

        // Inicializar la escena
        function init() {
            // 1. Escena y Cámara
            const container = document.getElementById('canvas-container');
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050b14, 0.02);

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(15, 10, 20);

            // 2. Renderizador
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);

            // 3. Controles
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.maxPolarAngle = Math.PI / 2 - 0.05; // No ir por debajo del suelo

            // 4. Iluminación
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);

            const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
            dirLight.position.set(10, 20, 10);
            dirLight.castShadow = true;
            dirLight.shadow.mapSize.width = 2048;
            dirLight.shadow.mapSize.height = 2048;
            scene.add(dirLight);

            const blueLight = new THREE.PointLight(0x3b82f6, 1, 20);
            blueLight.position.set(-5, 5, -5);
            scene.add(blueLight);

            // 5. Construir la Estación (Sincronizador)
            construirEstacion();

            // 6. Event Listeners
            window.addEventListener('resize', onWindowResize, false);

            // 7. Iniciar Loop
            animate();
        }

        function construirEstacion() {
            // Suelo (Concreto logístico)
            const sueloGeo = new THREE.PlaneGeometry(50, 50);
            const sueloMat = new THREE.MeshStandardMaterial({ 
                color: 0x1e293b, 
                roughness: 0.8, 
                metalness: 0.2 
            });
            const suelo = new THREE.Mesh(sueloGeo, sueloMat);
            suelo.rotation.x = -Math.PI / 2;
            suelo.receiveShadow = true;
            scene.add(suelo);

            // Cuadrícula decorativa (estilo ciberfísico)
            const gridHelper = new THREE.GridHelper(50, 50, 0x3b82f6, 0xffffff);
            gridHelper.material.opacity = 0.1;
            gridHelper.material.transparent = true;
            scene.add(gridHelper);

            // Base de la estructura metálica
            const baseGeo = new THREE.BoxGeometry(10, 0.5, 6);
            const baseMat = new THREE.MeshStandardMaterial({ color: 0x334155, roughness: 0.6, metalness: 0.5 });
            const base = new THREE.Mesh(baseGeo, baseMat);
            base.position.y = 0.25;
            base.castShadow = true;
            base.receiveShadow = true;
            scene.add(base);

            // Patas de soporte
            const pataGeo = new THREE.CylinderGeometry(0.2, 0.2, 2, 16);
            const pataMat = new THREE.MeshStandardMaterial({ color: 0xf59e0b, roughness: 0.3, metalness: 0.8 }); // Amarillo industrial
            const posicionesPatas = [
                [-4.5, 1.25, -2.5], [4.5, 1.25, -2.5],
                [-4.5, 1.25, 2.5], [4.5, 1.25, 2.5]
            ];

            posicionesPatas.forEach(pos => {
                const pata = new THREE.Mesh(pataGeo, pataMat);
                pata.position.set(...pos);
                pata.castShadow = true;
                scene.add(pata);
            });

            // Sensores / Celdas de Carga (Los que filtra Kalman)
            const sensorGeo = new THREE.BoxGeometry(0.6, 0.4, 0.6);
            const sensorMat = new THREE.MeshStandardMaterial({ color: 0xef4444, emissive: 0x991b1b }); // Rojo sensor
            posicionesPatas.forEach(pos => {
                const sensor = new THREE.Mesh(sensorGeo, sensorMat);
                sensor.position.set(pos[0], pos[1] + 1.1, pos[2]);
                sensor.castShadow = true;
                scene.add(sensor);
                sensores.push(sensor);
            });

            // Plataforma Principal (Banda/Báscula)
            const platGeo = new THREE.BoxGeometry(9.5, 0.3, 5.5);
            const platMat = new THREE.MeshStandardMaterial({ color: 0x94a3b8, roughness: 0.4, metalness: 0.7 });
            plataforma = new THREE.Mesh(platGeo, platMat);
            plataforma.position.y = 2.65;
            plataforma.castShadow = true;
            plataforma.receiveShadow = true;
            scene.add(plataforma);

            // Torre de Control Edge Computing
            const torreGeo = new THREE.BoxGeometry(0.8, 4, 0.8);
            const torreMat = new THREE.MeshStandardMaterial({ color: 0x334155 });
            const torre = new THREE.Mesh(torreGeo, torreMat);
            torre.position.set(-6, 2, 0);
            torre.castShadow = true;
            scene.add(torre);

            // Pantalla / Gateway
            const pantallaGeo = new THREE.BoxGeometry(1.5, 1, 0.2);
            const pantallaMat = new THREE.MeshStandardMaterial({ color: 0x000000 });
            const pantalla = new THREE.Mesh(pantallaGeo, pantallaMat);
            pantalla.position.set(-5.8, 3.5, 0);
            pantalla.rotation.y = Math.PI / 4;
            scene.add(pantalla);

            // Luz de la pantalla (UI Digital)
            const screenLightMat = new THREE.MeshBasicMaterial({ color: 0x3b82f6 });
            const screenLight = new THREE.Mesh(new THREE.PlaneGeometry(1.4, 0.9), screenLightMat);
            screenLight.position.set(0, 0, 0.11);
            pantalla.add(screenLight);
        }

        // Simular la llegada de carga
        function simularCarga() {
            if (simulando) return;
            simulando = true;
            
            document.getElementById('sync-ui').innerText = "Procesando...";
            document.getElementById('sync-ui').className = "data-value value-warning";

            // Crear un bulto/paleta
            const cajaGeo = new THREE.BoxGeometry(2 + Math.random(), 1.5 + Math.random(), 1.5 + Math.random());
            const cajaMat = new THREE.MeshStandardMaterial({ 
                color: 0x8b5a2b, // Color cartón/madera
                roughness: 0.9 
            });
            const caja = new THREE.Mesh(cajaGeo, cajaMat);
            
            // Posición aleatoria sobre la plataforma
            caja.position.set(
                (Math.random() - 0.5) * 6,
                5, // Cae desde arriba
                (Math.random() - 0.5) * 3
            );
            caja.castShadow = true;
            scene.add(caja);
            cajas.push(caja);

            // Animación simple de caída
            const dropInterval = setInterval(() => {
                caja.position.y -= 0.2;
                if (caja.position.y <= 2.8 + cajaGeo.parameters.height / 2) {
                    caja.position.y = 2.8 + cajaGeo.parameters.height / 2;
                    clearInterval(dropInterval);
                    
                    // Efecto visual en sensores
                    sensores.forEach(s => s.material.emissive.setHex(0x10b981)); // Verde
                    setTimeout(() => sensores.forEach(s => s.material.emissive.setHex(0x991b1b)), 500);

                    // Actualizar UI
                    pesoActual += (Math.random() * 500) + 100;
                    document.getElementById('peso-ui').innerText = pesoActual.toFixed(2) + " kg";
                    
                    // Simular Filtro de Kalman y QA
                    document.getElementById('kalman-ui').innerText = "Corrigiendo... Ruido: " + (Math.random() * 5).toFixed(1) + "%";
                    setTimeout(() => {
                        document.getElementById('kalman-ui').innerText = "Activo (Ruido: 0.2%)";
                        document.getElementById('sync-ui').innerText = "Sincronizado (Zero-Trust)";
                        document.getElementById('sync-ui').className = "data-value value-blue";
                        document.getElementById('latencia-ui').innerText = Math.floor(Math.random() * 10 + 10) + " ms";
                        simulando = false;
                    }, 800);
                }
            }, 30);
        }

        function limpiarPlataforma() {
            cajas.forEach(caja => scene.remove(caja));
            cajas = [];
            pesoActual = 0;
            document.getElementById('peso-ui').innerText = "0.00 kg";
            document.getElementById('sync-ui').innerText = "En Espera...";
            document.getElementById('sync-ui').className = "data-value value-blue";
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        // Arrancar
        window.onload = init;
    </script>
</body>
</html>
